<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Bairro: Boa Vista</title>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        crossorigin="">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #fff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: #0f172a;
    }

    #map {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      background: #fff;
    }

    /* Barra superior */
    .topbar {
      position: absolute;
      z-index: 1100;
      left: 10px;
      top: 10px;
      background: rgba(255,255,255,.95);
      padding: 8px 10px;
      border-radius: 10px;
      box-shadow: 0 12px 32px rgba(0,0,0,.15);
      border: 1px solid rgba(0,0,0,0.07);
      font-size: 13px;
      font-weight: 600;
      color: #0f172a;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 6px 10px;
      background:#fff;
      border:1px solid #ccc;
      border-radius:8px;
      cursor:pointer;
      font-size: 13px;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }

    .bairroNome {
      font-weight:700;
      color:#0f172a;
    }

    /* Painel lateral din√¢mico */
    .info-panel {
      position: absolute;
      z-index: 1200;
      right: 10px;
      top: 70px;
      max-width: 300px;
      width: 300px;
      background: rgba(255,255,255,0.98);
      border: 1px solid rgba(0,0,0,0.15);
      border-radius: 12px;
      box-shadow: 0 20px 48px rgba(0,0,0,.25);
      padding: 16px 18px;
      font-size: 13px;
      line-height: 1.5;
      color:#1e293b;
      transition: all 0.3s ease;
    }

    .info-title {
      font-size: 15px;
      font-weight:700;
      color:#0f172a;
      margin-bottom:10px;
      line-height:1.4;
      word-break: break-word;
    }

    .info-label {
      font-size:12px;
      font-weight:600;
      color:#111827;
      margin-bottom:3px;
      line-height:1.4;
    }

    .info-value {
      font-size:13px;
      color:#374151;
      line-height:1.5;
      word-break:break-word;
      white-space:normal;
      margin-bottom:8px;
    }

    .badge-acess {
      font-size:12px;
      font-weight:600;
      color:#065f46;
      background:#ecfdf5;
      border:1px solid #6ee7b7;
      border-radius:8px;
      padding:4px 8px;
      display:inline-block;
      white-space:nowrap;
    }

    .info-hint {
      font-size:12px;
      color:#6b7280;
      line-height:1.4;
      font-style:italic;
    }

    /* Legenda fixa no canto inferior esquerdo */
    .legend {
      position: absolute;
      z-index: 1300;
      left: 10px;
      bottom: 20px;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 12px;
      line-height: 1.4;
      color: #111827;
      min-width: 160px;
    }

    .legend-title {
      font-size: 12px;
      font-weight: 700;
      color:#111827;
      margin-bottom:6px;
    }

    .legend-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom:4px;
      font-size:12px;
      line-height:1.3;
      color:#1f2937;
      font-weight:500;
    }

    .legend-swatch {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid rgba(0,0,0,0.2);
      flex-shrink: 0;
    }

    /* Responsivo (mobile) */
    @media(max-width: 480px){
      .info-panel {
        width: calc(100% - 20px);
        right: 10px;
        left: 10px;
        top: auto;
        bottom: 10px;
        max-width: none;
      }

      .legend {
        left: 10px;
        bottom: 140px;
      }
    }
  </style>
</head>
<body>

  <!-- mapa -->
  <div id="map" aria-label="Mapa do bairro Boa Vista"></div>

  <!-- barra superior -->
  <div class="topbar">
    <div class="bairroNome">Bairro: Boa Vista</div>
    <button class="btn" onclick="window.location.href='index.html'">Voltar</button>
    <button class="btn" id="resetViewBtn">Resetar vis√£o</button>
  </div>

  <!-- painel lateral -->
  <div class="info-panel" id="infoPanel">
    <div class="info-title">Passe o mouse sobre um ponto</div>
    <div class="info-hint">Veja os detalhes do servi√ßo.</div>
  </div>

  <!-- legenda -->
  <div class="legend" id="legendBox">
    <div class="legend-title">Tipos de servi√ßo</div>

    <div class="legend-row">
      <div class="legend-swatch" style="background:#2563eb;"></div>
      <div>Sa√∫de</div>
    </div>

    <div class="legend-row">
      <div class="legend-swatch" style="background:#22c55e;"></div>
      <div>Assist√™ncia Social</div>
    </div>

    <div class="legend-row">
      <div class="legend-swatch" style="background:#8b5cf6;"></div>
      <div>Cultura / Esporte</div>
    </div>

    <div class="legend-row">
      <div class="legend-swatch" style="background:#f97316;"></div>
      <div>Educa√ß√£o</div>
    </div>

    <div class="legend-row">
      <div class="legend-swatch" style="background:#6b7280;"></div>
      <div>Outros</div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <script>
    // URL oficial com todos os bairros em GeoJSON
    const BAIRROS_URL =
      "https://geo.joinville.sc.gov.br/server/rest/services/Hosted/BAIRROS/FeatureServer/3/query?where=1%3D1&outFields=*&f=geojson";

    // Paleta de cores por categoria de servi√ßo
    // "saude" = azul üíô
    const SERVICE_COLORS = {
      "saude":            "#2563eb", // azul
      "assistencia":      "#22c55e", // verde
      "cultura-esporte":  "#8b5cf6", // roxo
      "educacao":         "#f97316", // laranja
      "outros":           "#6b7280"  // cinza
    };

    // Lista dos servi√ßos do bairro Boa Vista
    // Cada servi√ßo tem:
    //  - categoria: define a cor do pin
    //  - lat/lng: coordenadas j√° preenchidas
    const servicesBairro = [
      {
        categoria: "saude",
        tipo: "Sa√∫de / UBSF",
        nomeServico: "UBSF Bakhitas",
        endereco: "Rua Albano Schmidt, 2116",
        telefone: "(47) 3432-2220",
        horario: "Segunda √† sexta das 7h √†s 19h.",
        responsavel: "Keila Fehlauer Bento Lunelli",
        observacoes: "Unidade b√°sica com atendimento odontol√≥gico e vacina√ß√£o.",
        acessibilidade: "Sim",
        lat: -26.2976563,
        lng: -48.8213076
      },
      {
        categoria: "saude",
        tipo: "Sa√∫de / Hospital",
        nomeServico: "Hospital Regional Hans Dieter Schmidt",
        endereco: "Rua Xavier Arp, 330",
        telefone: "(47) 3481-3100",
        horario: "Todos os dias, 24h",
        responsavel: "Aldilete Cardoso Alves Fantuci",
        observacoes: "Centro Hospitalar.",
        acessibilidade: "Sim",
        lat: -26.2827458,
        lng: -48.8126093
      },
      {
        categoria: "saude",
        tipo: "Sa√∫de / APAE",
        nomeServico: "APAE de Joinville",
        endereco: "Rua Jose Elias Guliari, 111",
        telefone: "(47) 3431-7400",
        horario: "Segunda √† sexta das 7h30 √†s 17h30.",
        responsavel: "Neide Gon√ßalves",
        observacoes: "Cuidados, apoio e atividades para pessoas com defici√™ncia em per√≠odo integral ou parcial.",
        acessibilidade: "Sim",
        lat: -26.3049252,
        lng: -48.834866
      },
      {
        categoria: "saude",
        tipo: "Sa√∫de / Associa√ß√£o",
        nomeServico: "ADEJ (Associa√ß√£o dos Deficientes F√≠sicos de Joinville)",
        endereco: "Rua Jose Elias Guliari, 95",
        telefone: "(47) 3433-6355",
        horario: "Segunda √† sexta das 8h √†s 17h.",
        responsavel: "Nilsa Wanzuita Schramm",
        observacoes: "Reabilitar e reintegrar √† sociedade as pessoas com defici√™ncia f√≠sica.",
        acessibilidade: "Sim",
        lat: -26.3049252,
        lng: -48.831866
      }
    ];

    // --- Utilit√°rios ---

    // Normaliza o nome pra comparar com o GeoJSON
    function normalizeName(str){
      return String(str || "")
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g,"")
        .toLowerCase()
        .trim();
    }

    // Detecta se a feature √© o bairro "Boa Vista"
    function isBoaVista(raw){
      const n = normalizeName(raw);
      return n.includes("boa") && n.includes("vista");
    }

    // Escapa HTML pra seguran√ßa do painel
    function escapeHTML(str){
      return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    // Atualiza painel lateral com dados do servi√ßo
    function renderInfoPanel(s){
      const panel = document.getElementById('infoPanel');
      panel.innerHTML = `
        <div class="info-title">${escapeHTML(s.nomeServico)}</div>

        <div class="info-label">Tipo de Servi√ßo</div>
        <div class="info-value">${escapeHTML(s.tipo)}</div>

        <div class="info-label">Endere√ßo</div>
        <div class="info-value">${escapeHTML(s.endereco)}</div>

        <div class="info-label">Telefone</div>
        <div class="info-value">${escapeHTML(s.telefone)}</div>

        <div class="info-label">Hor√°rio de Atendimento</div>
        <div class="info-value">${escapeHTML(s.horario)}</div>

        ${s.responsavel ? `
          <div class="info-label">Respons√°vel</div>
          <div class="info-value">${escapeHTML(s.responsavel)}</div>
        ` : ""}

        <div class="info-label">Descri√ß√£o / Observa√ß√µes</div>
        <div class="info-value">${escapeHTML(s.observacoes)}</div>

        <div class="badge-acess">Acessibilidade: ${escapeHTML(s.acessibilidade)}</div>
      `;
    }

    // Volta pro estado padr√£o do painel
    function resetInfoPanel(){
      document.getElementById('infoPanel').innerHTML = `
        <div class="info-title">Passe o mouse sobre um ponto</div>
        <div class="info-hint">Veja os detalhes do servi√ßo.</div>
      `;
    }

    // Cria o √≠cone/pin colorido pela categoria
    function makePinIcon(colorHex){
      return L.icon({
        iconUrl: 'data:image/svg+xml;utf8,' + encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none">
            <path d="M16 2C10.2 2 5.5 6.7 5.5 12.5c0 2.9 1.2 5.1 2.8 7.3 1.7 2.1 3.8 4.1 5.5 6.2.8 1 1.6 2 2.2 3 .6-1 1.4-2 2.2-3 1.7-2.1 3.8-4.1 5.5-6.2 1.6-2.2 2.8-4.4 2.8-7.3C26.5 6.7 21.8 2 16 2z"
              fill="${colorHex}"/>
            <circle cx="16" cy="12" r="4.5" fill="white"/>
          </svg>
        `),
        iconSize: [32, 32],
        iconAnchor: [16, 32]
      });
    }

    // --- Inicializa√ß√£o do mapa ---
    document.addEventListener('DOMContentLoaded', () => {
      const map = L.map('map');
      let combinedBounds = null;

      fetch(BAIRROS_URL)
        .then(r => r.json())
        .then(gj => {
          // filtrar s√≥ o bairro Boa Vista
          const onlyThisBairro = {
            type: "FeatureCollection",
            features: (gj.features || []).filter(f => {
              const props = f.properties || {};
              const rawName = props.nome_bairr || props.NOME || props.name || "";
              return isBoaVista(rawName);
            })
          };

          if (!onlyThisBairro.features.length){
            alert("Bairro Boa Vista n√£o encontrado no mapa oficial.");
            return;
          }

          // desenhar o pol√≠gono do bairro
          const bairroLayer = L.geoJSON(onlyThisBairro, {
            style: {
              color: "#1e293b",      // borda escura
              weight: 3,
              fillColor: "#60a5fa",  // azul claro transl√∫cido
              fillOpacity: 0.25
            }
          }).addTo(map);

          // come√ßar os bounds com o bairro inteiro
          combinedBounds = bairroLayer.getBounds();

          // adicionar os servi√ßos
          servicesBairro.forEach(svc => {
            if (svc.lat != null && svc.lng != null) {
              const cor = SERVICE_COLORS[svc.categoria] || SERVICE_COLORS["outros"];
              const marker = L.marker([svc.lat, svc.lng], {
                icon: makePinIcon(cor)
              }).addTo(map);

              // hover mostra os dados no painel
              marker.on('mouseover', () => renderInfoPanel(svc));
              // tirar o mouse reseta painel
              marker.on('mouseout', resetInfoPanel);

              // incluir o ponto no ajuste de bounds
              combinedBounds.extend([svc.lat, svc.lng]);
            }
          });

          // enquadrar bairro (e pontos se tiver)
          map.fitBounds(combinedBounds, { padding:[30,30] });

          // bot√£o resetar vis√£o
          document.getElementById('resetViewBtn').addEventListener('click', () => {
            if (combinedBounds && combinedBounds.isValid()) {
              map.fitBounds(combinedBounds, { padding:[30,30] });
            }
          });

        })
        .catch(err => {
          console.error("Erro carregando bairro Boa Vista:", err);
          alert("Erro ao carregar dados do bairro.");
        });
    });
  </script>
</body>
</html>